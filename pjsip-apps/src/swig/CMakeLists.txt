cmake_minimum_required(VERSION 3.10)
project(pjsua2_java_binding)

# 1. Find Dependencies
find_package(Java REQUIRED)
find_package(JNI REQUIRED)
find_package(SWIG REQUIRED)
include(${SWIG_USE_FILE})

# 2. Locate PJSIP Core Headers and Libraries
# Adjust these paths if your directory structure differs
set(PJ_ROOT "../../../")
include_directories(
    ${PJ_ROOT}/pjlib/include
    ${PJ_ROOT}/pjlib-util/include
    ${PJ_ROOT}/pjnath/include
    ${PJ_ROOT}/pjmedia/include
    ${PJ_ROOT}/pjsip/include
    ${JNI_INCLUDE_DIRS}
)

# 3. Define the SWIG module
# This tells CMake to generate java code in 'java/output'
set(CMAKE_SWIG_FLAGS -package org.pjsip.pjsua2 -outdir ${CMAKE_CURRENT_SOURCE_DIR}/java/output)
set_source_files_properties(pjsua2.i PROPERTIES CPLUSPLUS ON)

# 4. Create the DLL
# Name it 'pjsua2' so System.loadLibrary("pjsua2") works
swig_add_library(pjsua2
    TYPE SHARED
    LANGUAGE java
    SOURCES pjsua2.i
)

# 5. Link against PJSIP Core Libraries
# You must link all PJSIP libs. On Windows, these are usually merged into libpjproject
# Ensure you have built the core PJSIP library first!
link_directories(${PJ_ROOT}/lib)

if(WIN32)
    # Link against standard Windows libs and PJSIP
    # Note: You might need to change 'libpjproject' to the specific name generated by your build 
    # (e.g., libpjproject-i386-win32-vc14-release.lib)
    target_link_libraries(pjsua2 
        libpjproject 
        ws2_32 ole32 dsound
        ${JNI_LIBRARIES}
    )
endif()
